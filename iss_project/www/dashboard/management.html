{% block head_include %}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/heroicons@2.1.1/dist/heroicons.js"></script>
{% endblock %}

<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Management Portfolio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>

<body class="bg-gray-100 min-h-screen">

  <div class="max-w-7xl mx-auto p-6">

    <h1 class="text-3xl font-bold mb-8 text-gray-800 flex items-center gap-3">
      <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor"><use href="#chart-pie"/></svg>
      Management Portfolio Dashboard
    </h1>

    <!-- SUMMARY CARDS -->
    <div id="top_summary" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-10"></div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

      <!-- PM Ranking -->
      <section class="bg-white p-6 rounded-2xl shadow hover:shadow-xl transition border border-gray-100">
        <h2 class="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-700">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor"><use href="#trophy"/></svg>
          PM Ranking
        </h2>
        <div id="pm_ranking" class="space-y-4"></div>
      </section>

      <!-- RAG Health -->
      <section class="bg-white p-6 rounded-2xl shadow hover:shadow-xl transition border border-gray-100">
        <h2 class="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-700">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor"><use href="#status-online"/></svg>
          RAG Health
        </h2>
        <div id="rag_box"></div>
      </section>

    </div>

  </div>


<!-- HEROICONS SYMBOLS -->
<svg style="display:none;">

  <symbol id="chart-pie" viewBox="0 0 24 24" stroke-width="1.8">
    <path d="M11 2a10 10 0 100 20 10 10 0 000-20z"/>
    <path d="M11 14V2a10 10 0 019 9h-9z"/>
  </symbol>

  <symbol id="trophy" viewBox="0 0 24 24" stroke-width="1.8">
    <path d="M8 21h8"/>
    <path d="M12 17a5 5 0 005-5V4H7v8a5 5 0 005 5z"/>
    <path d="M5 8H3V4h4"/>
    <path d="M19 8h2V4h-4"/>
  </symbol>

  <symbol id="status-online" viewBox="0 0 24 24" stroke-width="1.8">
    <circle cx="12" cy="12" r="9"/>
    <circle cx="12" cy="12" r="4"/>
  </symbol>

</svg>


<!-- JS LOGIC -->
<script>
async function loadMgmt() {
  const res = await fetch('/api/method/iss_project.www.api.dashboard_api.get_management_dashboard');
  const json = await res.json();
  const data = json.message || {};

  const summary = document.getElementById('top_summary');
  summary.innerHTML = '';

  const items = [
    { label: "Projects", value: data.project_count || 0, icon: "chart-pie" },
    { label: "Avg Utilization %", value: Math.round(data.avg_utilization || 0), icon: "status-online" },
    { label: "Top PM Score", value: (data.pm_ranking?.[0]?.avg_score && Math.round(data.pm_ranking[0].avg_score)) || "-", icon: "trophy" }
  ];

  items.forEach(item => {
    summary.innerHTML += `
      <div class="bg-white p-6 rounded-2xl shadow hover:shadow-xl border border-gray-100 transition text-center">
        <div class="flex justify-center mb-3">
          <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor">
            <use href="#${item.icon}"></use>
          </svg>
        </div>
        <div class="text-gray-500 text-sm">${item.label}</div>
        <div class="text-3xl font-bold text-gray-800">${item.value}</div>
      </div>
    `;
  });

  // PM Ranking
  const pm = document.getElementById('pm_ranking');
  pm.innerHTML = (data.pm_ranking || []).map(p => `
    <div class="p-4 bg-gray-50 rounded-xl shadow-sm hover:bg-gray-100 transition">
      <div class="font-semibold text-gray-800">${p.project_manager}</div>
      <div class="text-sm text-gray-600">Score: ${Math.round(p.avg_score || 0)}</div>
    </div>
  `).join('');

  // RAG Health
  const rag = data.rag || { red:0, amber:0, green:0 };
  document.getElementById('rag_box').innerHTML = `
    <div class="grid grid-cols-3 gap-4">
      
      <div class="p-5 rounded-2xl bg-red-100 border border-red-300 text-center">
        <div class="text-red-700 text-3xl font-bold">${rag.red}</div>
        <div class="text-sm font-medium text-red-700">Red</div>
      </div>

      <div class="p-5 rounded-2xl bg-amber-100 border border-amber-300 text-center">
        <div class="text-amber-700 text-3xl font-bold">${rag.amber}</div>
        <div class="text-sm font-medium text-amber-700">Amber</div>
      </div>

      <div class="p-5 rounded-2xl bg-green-100 border border-green-300 text-center">
        <div class="text-green-700 text-3xl font-bold">${rag.green}</div>
        <div class="text-sm font-medium text-green-700">Green</div>
      </div>

    </div>`;
}

loadMgmt();
</script>

</body>
</html>
