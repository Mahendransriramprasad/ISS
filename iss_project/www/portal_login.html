{% block head_include %}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/heroicons@2.1.1/dist/heroicons.js"></script>
{% endblock %}

<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100 p-6">

  <div class="bg-white/80 backdrop-blur-xl p-8 rounded-2xl shadow-xl w-full max-w-sm border border-blue-100">

    <!-- Title -->
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800 flex items-center justify-center gap-2">
      <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor">
        <use href="#lock-closed" />
      </svg>
      Internal Portal Login
    </h1>

    <!-- Email -->
    <div class="mb-4">
      <label class="text-gray-600 text-sm mb-1 block">Email</label>
      <div class="relative">
        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3" fill="none" stroke="currentColor">
          <use href="#envelope" />
        </svg>
        <input id="email" type="text"
          class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
          placeholder="Enter your email">
      </div>
    </div>

    <!-- Password -->
    <div class="mb-6">
      <label class="text-gray-600 text-sm mb-1 block">Password</label>
      <div class="relative">
        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3" fill="none" stroke="currentColor">
          <use href="#key" />
        </svg>
        <input id="password" type="password"
          class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
          placeholder="Enter your password">
      </div>
    </div>

    <!-- Login Button -->
    <button onclick="loginPortal()"
      class="w-full bg-blue-600 hover:bg-blue-700 transition-all text-white py-3 rounded-lg font-semibold shadow-md flex items-center justify-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor">
        <use href="#arrow-right-circle" />
      </svg>
      Login
    </button>

    <p id="error" class="text-red-500 text-sm mt-4 text-center"></p>

  </div>
</div>

<!-- Icons -->
<svg style="display:none;">
  <symbol id="lock-closed" viewBox="0 0 24 24" stroke-width="1.8">
    <path d="M8 11V7a4 4 0 118 0v4" />
    <rect x="5" y="11" width="14" height="10" rx="2" />
  </symbol>

  <symbol id="envelope" viewBox="0 0 24 24" stroke-width="1.8">
    <path d="M3 7l9 6 9-6" />
    <rect x="3" y="5" width="18" height="14" rx="2" />
  </symbol>

  <symbol id="key" viewBox="0 0 24 24" stroke-width="1.8">
    <circle cx="7" cy="17" r="3" />
    <path d="M10 17h10l-3-3 3-3H13" />
  </symbol>

  <symbol id="arrow-right-circle" viewBox="0 0 24 24" stroke-width="1.8">
    <circle cx="12" cy="12" r="9" />
    <path d="M10 8l4 4-4 4" />
  </symbol>
</svg>


<script>
async function loginPortal() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const body = new URLSearchParams();
  body.append("email", email);
  body.append("password", password);

  try {
    const res = await fetch("/api/method/iss_project.www.portal_login", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
        "Accept": "application/json"
      },
      body: body.toString()
    });

    const data = await res.json();

    if (res.ok && data.message?.status === "success") {
      window.location.href = data.message.redirect || "/";
      return;
    }

    const err = data.message?.message || data.message || "Login failed";
    document.getElementById("error").innerText = err;

  } catch (e) {
    document.getElementById("error").innerText = "Network error. Check server logs.";
  }
}
</script>
